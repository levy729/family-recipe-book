#!/usr/bin/env sh

echo "ğŸ” Running linting and formatting checks..."
npm run lint

if [ $? -ne 0 ]; then
  echo "âŒ Linting failed! Push aborted."
  exit 1
fi

npm run format:check

if [ $? -ne 0 ]; then
  echo "âŒ Code formatting issues found! Run 'npm run format' to fix. Push aborted."
  exit 1
fi

echo "ğŸ”¨ Building main project..."
npm run build

if [ $? -ne 0 ]; then
  echo "âŒ Main project build failed! Push aborted."
  exit 1
fi

echo "ğŸ”¨ Building recipe builder..."
cd recipe-builder && npm run build

if [ $? -ne 0 ]; then
  echo "âŒ Recipe builder build failed! Push aborted."
  exit 1
fi

cd ..

echo "âœ… Build successful! Running tests..."
npm run test:ci

if [ $? -ne 0 ]; then
  echo "âŒ Main project tests failed! Push aborted."
  exit 1
fi

echo "ğŸ§ª Running recipe builder tests..."
cd recipe-builder && npm test

if [ $? -ne 0 ]; then
  echo "âŒ Recipe builder tests failed! Push aborted."
  exit 1
fi

echo "âœ… All checks passed! Ready to push." 